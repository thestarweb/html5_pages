<!DOCTYPE html>
<html style="width: 100%;height: 100%;">
<head>
	<title>mid</title>
	<meta charset="utf-8">
	<script src="../myScript/myScript2.js"></script>
	<script src="./stream.js"></script>
	<script src="./mid-file.js"></script>
	<script src="./star-midi.js"></script>
	<script src="./show-midi.js"></script>
	<style type="text/css">
		*{
			margin: 0;
			padding: 0;
		}
	</style>
</head>
<body style="width: 100%;height: 100%;">
	<canvas style="width: 100%;height: 100%;" id="canvas"></canvas>
	<script type="text/javascript">
		var show=new MindShow("canvas");
		// var xhr=$.ajax();
		// xhr.page="./SKYCITY1.MID";
		// xhr.ajax.overrideMimeType('text/plain; charset=x-user-defined');
		// xhr.callback=function(aa){
		// 	var t = aa.text || '';
		// 	var ff = [];
		// 	var mx = t.length;
		// 	var scc = String.fromCharCode;
		// 	for (var z = 0; z < mx; z++) {
		// 		ff[z] = scc(t.charCodeAt(z) & 255);
		// 	}
		// 	var file=MidiFile(ff.join(''));
		// 	console.log(file);
		// 	// var data=file.tracks[8];
		// 	// for(var i=0;i<data.length;i++){
		// 	// 	if(data[i].type=="channel"&&data[i].subtype=="noteOn"){
		// 	// 		var m=data[i].noteNumber;//+6;
		// 	// 		if(m/sound.length<5)continue;
		// 	// 		//if(data[i].channel!=11) continue;
		// 	// 		console.log(data[i],parseInt(m/sound.length),sound[m%sound.length]);
		// 	// 	}
		// 	// }
		// 	// window.s=new SMidiFile(ff.join(''));
		// 	// show.draw();
		// 	show.load(ff.join(''));
		// }
		// xhr.send();

		document.addEventListener("dragleave", function(e){  
			e.stopPropagation();
			e.preventDefault();
		}, false);
		document.addEventListener("dragover", function(e){  
			e.stopPropagation();
			e.preventDefault();
		}, false);
		document.addEventListener("drop", function(e){  
			e.stopPropagation();  
			e.preventDefault();
			if(e.dataTransfer.files.length==0) return;
			for(var i=0;i<e.dataTransfer.files.length;i++){
				var filename=e.dataTransfer.files[i].name;
				var exname=filename.substr(filename.lastIndexOf("."));
				if(exname="mid"){
					var reader = new FileReader();
					reader.onload=function(ev){
						//window.s=new SMidiFile(this.result);
						show.load(this.result);
					}
					reader.readAsBinaryString(e.dataTransfer.files[i]);
					return;
				}
			}
		}, false);

	</script>
</body>
</html>